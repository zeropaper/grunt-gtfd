
<html>
<head>
  <title>index.js</title>
  <link type="text/css" rel="stylesheet" href="../assets/styles/styles.css" />
</head>
<body>
  <header>
    <div class="row">
      <h3><a href="../index.html">Index</a></h3>
      <ul class="breadcrumb"><li>lib</li></ul>
    </div>
    <h1>index.js</h1>
  </header>

  <nav class="docs-nav">
<div class="search"></div>
<div class="toggle">Files</div>
<ul class="directory root">
<li class="">

<a href="../Gruntfile.js.html">Gruntfile.js</a>

</li>

<li class="">

</li>

<li class="trail">


<span class="dirname">lib</span>

<ul class="directory">

<li class="">

<a href="blocks-collection.js.html">blocks-collection.js</a>

</li>

<li class="active">

<a href="index.js.html">index.js</a>

</li>

<li class="">

<a href="rendering-utils.js.html">rendering-utils.js</a>

</li>

</ul>

</li>

<li class="">


<span class="dirname">node_modules</span>

<ul class="directory">

<li class="">


<span class="dirname">ampersand-collection</span>

<ul class="directory">

<li class="">

<a href="../node_modules/ampersand-collection/ampersand-collection.js.html">ampersand-collection.js</a>

</li>

</ul>

</li>

<li class="">


<span class="dirname">ampersand-model</span>

<ul class="directory">

<li class="">

<a href="../node_modules/ampersand-model/ampersand-model.js.html">ampersand-model.js</a>

</li>

</ul>

</li>

<li class="">


<span class="dirname">files-collection</span>

<ul class="directory">

<li class="">

<a href="../node_modules/files-collection/index.js.html">index.js</a>

</li>

</ul>

</li>

</ul>

</li>

<li class="">


<span class="dirname">resources</span>

<ul class="directory">

<li class="">


<span class="dirname">themes</span>

<ul class="directory">

<li class="">


<span class="dirname">default</span>

<ul class="directory">

<li class="">

<a href="../resources/themes/default/file.jst.html">file.jst</a>

</li>

<li class="">

<a href="../resources/themes/default/navigation-item.jst.html">navigation-item.jst</a>

</li>

<li class="">

<a href="../resources/themes/default/navigation.jst.html">navigation.jst</a>

</li>

<li class="">


<span class="dirname">assets</span>

<ul class="directory">

<li class="">


<span class="dirname">scripts</span>

<ul class="directory">

<li class="">

<a href="../resources/themes/default/assets/scripts/scripts.src.js.html">scripts.src.js</a>

</li>

<li class="">

<a href="../resources/themes/default/assets/scripts/search.src.js.html">search.src.js</a>

</li>

</ul>

</li>

<li class="">


<span class="dirname">styles</span>

<ul class="directory">

<li class="">

<a href="../resources/themes/default/assets/styles/styles.css.html">styles.css</a>

</li>

</ul>

</li>

</ul>

</li>

</ul>

</li>

</ul>

</li>

</ul>

</li>

<li class="">


<span class="dirname">tasks</span>

<ul class="directory">

<li class="">

<a href="../tasks/gtfd.js.html">gtfd.js</a>

</li>

</ul>

</li>
</ul>
</nav>


  <div class="container content">
    <div>
      

      
      <div class="row">
        <div class="col-md-12 col-lg-6"><h1 id="gtfd-library">gtfd library</h1>
</div>
        <div class="col-md-12 col-lg-6"><pre><code class="js"><span class="hljs-pi">'use strict'</span>;
<span class="hljs-comment">/* jshint node:true */</span>
<span class="hljs-keyword">var</span> fs                      = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);
<span class="hljs-keyword">var</span> _                       = <span class="hljs-built_in">require</span>(<span class="hljs-string">'underscore'</span>);
<span class="hljs-keyword">var</span> mkdirp                  = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mkdirp'</span>);
<span class="hljs-keyword">var</span> marked                  = <span class="hljs-built_in">require</span>(<span class="hljs-string">'marked'</span>);
<span class="hljs-keyword">var</span> hljs                    = <span class="hljs-built_in">require</span>(<span class="hljs-string">'highlight.js'</span>);
<span class="hljs-keyword">var</span> OriginalFilesCollection = <span class="hljs-built_in">require</span>(<span class="hljs-string">'files-collection/node'</span>);
<span class="hljs-keyword">var</span> glob                    = <span class="hljs-built_in">require</span>(<span class="hljs-string">'glob'</span>);
<span class="hljs-keyword">var</span> path                    = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);

<span class="hljs-keyword">var</span> BlocksCollection        = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./blocks-collection'</span>);
<span class="hljs-keyword">var</span> utils                   = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./rendering-utils'</span>);


hljs.configure({
  tabReplace: <span class="hljs-string">'  '</span>
});

marked.setOptions({
  smartypants: <span class="hljs-literal">true</span>,

  highlight: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(code, lang)</span> </span>{
    <span class="hljs-keyword">if</span> (!hljs.getLanguage(lang)) {
      <span class="hljs-keyword">return</span> code;
    }

    <span class="hljs-keyword">return</span> hljs.highlight(lang, code).value;
  }
});



<span class="hljs-keyword">var</span> defaultExp = <span class="hljs-regexp">/^[\t ]*\/\/(| |.*)$/</span>;


<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">parseContent</span><span class="hljs-params">(content, lang, options)</span> </span>{
  options = options || {};
  <span class="hljs-keyword">var</span> hljsLang = hljs.getLanguage(lang);
  <span class="hljs-keyword">var</span> pairs = [];
  <span class="hljs-keyword">var</span> prevLineWasDoc = <span class="hljs-literal">false</span>;
  <span class="hljs-keyword">var</span> code = [];
  <span class="hljs-keyword">var</span> documentation = [];
  <span class="hljs-keyword">var</span> start = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">var</span> codeStart = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">var</span> current = <span class="hljs-number">0</span>;

</code></pre></div>
      </div>
      
      <div class="row">
        <div class="col-md-12 col-lg-6"><p> add a pair doc / code object</p>
</div>
        <div class="col-md-12 col-lg-6"><pre><code class="js">  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">pair</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">if</span> (documentation.length || code.length) {
      documentation = documentation.join(<span class="hljs-string">'\n'</span>);
      code = code.join(<span class="hljs-string">'\n'</span>);

      pairs.push({
        start: start,
        codeStart: codeStart,
        end: current - <span class="hljs-number">1</span>,
        lang: lang,

        original: {
          code: code,
          documentation: documentation,
        },

        documentation: marked(documentation),
        code: <span class="hljs-string">'&lt;pre&gt;&lt;code class="'</span> + lang + <span class="hljs-string">'"&gt;'</span> +
              (!!hljsLang ? hljs.highlight(lang, code).value : code) +
              <span class="hljs-string">'&lt;/code&gt;&lt;/pre&gt;'</span>
      });
    }

    code = [];
    documentation = [];
    start = current;
    codeStart = current;
  }


  (content || <span class="hljs-string">''</span>).split(<span class="hljs-string">'\n'</span>).forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(line, num)</span> </span>{</code></pre></div>
      </div>
      
      <div class="row">
        <div class="col-md-12 col-lg-6"><p> Determine if the line is aimed to document the code or the code itself.</p>
</div>
        <div class="col-md-12 col-lg-6"><pre><code class="js">    <span class="hljs-keyword">var</span> isDoc = line.match(defaultExp);
    current = num;
    <span class="hljs-built_in">console</span>.info(documentation.length, code.length, !!isDoc, !prevLineWasDoc &amp;&amp; !!isDoc, <span class="hljs-string">''</span> + (!!isDoc ? isDoc[<span class="hljs-number">1</span>] : <span class="hljs-string">'nopeeeeee'</span>));

    <span class="hljs-keyword">if</span> (prevLineWasDoc &amp;&amp; !isDoc) {
      codeStart = num;
    }
</code></pre></div>
      </div>
      
      <div class="row">
        <div class="col-md-12 col-lg-6"><p> If a new documentation block starts</p>
</div>
        <div class="col-md-12 col-lg-6"><pre><code class="js">    <span class="hljs-keyword">if</span> (!prevLineWasDoc &amp;&amp; !!isDoc) {
      pair();
    }

    <span class="hljs-keyword">if</span> (!!isDoc) {
      documentation.push(isDoc[<span class="hljs-number">1</span>]);
    }
    <span class="hljs-keyword">else</span> {
      code.push(line);
    }

    prevLineWasDoc = !!isDoc;
  });

  pair();

  <span class="hljs-keyword">return</span> pairs;
}



<span class="hljs-keyword">var</span> OriginalFileModel = OriginalFilesCollection.prototype.model;
<span class="hljs-keyword">var</span> FileModel = OriginalFileModel.extend({
  initialize: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;

    <span class="hljs-keyword">this</span>.on(<span class="hljs-string">'change:content'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
      self.blocks.reset(parseContent(self.content, self.lang));
    });

    OriginalFileModel.prototype.initialize.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>);

    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.exists &amp;&amp; <span class="hljs-keyword">this</span>.isFile) {
      <span class="hljs-keyword">this</span>.fetch();
    }
  },

  collections: {
    blocks: BlocksCollection
  },

  props: {
    title: <span class="hljs-string">'string'</span>
  },

  derived: {
    absolutePath: {
      deps: [<span class="hljs-string">'filepath'</span>],
      cache: <span class="hljs-literal">false</span>,
      fn: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.collection.cwd ?
                path.join(<span class="hljs-keyword">this</span>.collection.cwd, <span class="hljs-keyword">this</span>.filepath) :
                <span class="hljs-keyword">this</span>.filepath;
      }
    },

    exists: {
      deps: [<span class="hljs-string">'filepath'</span>],
      cache: <span class="hljs-literal">false</span>,
      fn: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> fs.existsSync(<span class="hljs-keyword">this</span>.absolutePath);
      }
    },

    isDir: {
      deps: [<span class="hljs-string">'filepath'</span>],
      cache: <span class="hljs-literal">false</span>,
      fn: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.exists ? fs.statSync(<span class="hljs-keyword">this</span>.absolutePath).isDirectory() : <span class="hljs-literal">false</span>;
      }
    },

    isFile: {
      deps: [<span class="hljs-string">'filepath'</span>],
      cache: <span class="hljs-literal">false</span>,
      fn: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.exists ? fs.statSync(<span class="hljs-keyword">this</span>.absolutePath).isFile() : <span class="hljs-literal">false</span>;
      }
    },

    lang: {
      deps: [<span class="hljs-string">'filepath'</span>],
      fn: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.isDir) {
          <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.filepath.split(<span class="hljs-string">'.'</span>).pop();
      }
    }
  },

  writeHTML: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(options)</span> </span>{
    options = _.clone(options || {});
    <span class="hljs-keyword">var</span> files = <span class="hljs-keyword">this</span>.collection;
    <span class="hljs-keyword">var</span> defaultThemePath = path.join(__dirname, <span class="hljs-string">'../resources/themes/default'</span>);

    _.defaults(options, {
      themePath:    defaultThemePath,
      templatePath: path.join(defaultThemePath, <span class="hljs-string">'file.jst'</span>),
      assets:       path.join(<span class="hljs-keyword">this</span>.relative(), <span class="hljs-string">'assets'</span>),
      assetsPath:   path.join(defaultThemePath, <span class="hljs-string">'assets'</span>),
      body:         <span class="hljs-string">''</span>,
      blocks:       <span class="hljs-keyword">this</span>.blocks.toJSON(),
      pageTitle:    <span class="hljs-keyword">this</span>.basename,
      multiFiles:   <span class="hljs-literal">false</span>
    });

    <span class="hljs-keyword">var</span> destination = options.destination || path.join(files.destination, <span class="hljs-keyword">this</span>.filepath);
    <span class="hljs-keyword">if</span> (options.body) {
      options.blocks = [];
    }

    <span class="hljs-keyword">var</span> template = _.isFunction(options.template) ?
                    options.template :
                    _.template(fs.readFileSync(options.templatePath).toString());

    <span class="hljs-comment">/*var active = '';*/</span>
    files.setActive(<span class="hljs-keyword">this</span>.filepath);

    <span class="hljs-keyword">var</span> data = {
      multiFiles:   options.multiFiles,
      pageTitle:    options.pageTitle,
      assets:       options.assets,
      destination:  destination,

      navigation:   utils.navigation(<span class="hljs-keyword">this</span>),
      breadcrumb:   utils.breadcrumb(<span class="hljs-keyword">this</span>),
      model:        <span class="hljs-keyword">this</span>
    };

    <span class="hljs-comment">/*files.setActive(active);*/</span>

    data.config = <span class="hljs-built_in">JSON</span>.stringify({
      files:  files.filepaths(),
      active: <span class="hljs-keyword">this</span>.filepath
    });

    files.trigger(<span class="hljs-string">'writefile'</span>, <span class="hljs-keyword">this</span>, destination);

    mkdirp.sync(path.dirname(destination));
    fs.writeFileSync(destination + <span class="hljs-string">'.html'</span>, template(data));
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
  }
});




<span class="hljs-keyword">var</span> FilesCollection = <span class="hljs-built_in">module</span>.exports = OriginalFilesCollection.extend({
  model: FileModel,

  cwd: <span class="hljs-string">''</span>,

  destination: <span class="hljs-string">''</span>,

  assets: <span class="hljs-string">''</span>,

  assetsPath: <span class="hljs-string">''</span>,

  initialize: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(models, options)</span> </span>{
    models = models || [];
    options = options || {};
    <span class="hljs-keyword">if</span> (!options.destination) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'Missing `destination` option.'</span>)
    }

    <span class="hljs-keyword">this</span>.destination = options.destination;
    OriginalFilesCollection.prototype.initialize.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>);
    <span class="hljs-keyword">this</span>.cwd = options.cwd || <span class="hljs-string">''</span>;
  },

  writeFiles: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">var</span> index = <span class="hljs-keyword">this</span>.get(<span class="hljs-string">'index'</span>);
    <span class="hljs-keyword">var</span> readme = <span class="hljs-keyword">this</span>.get(<span class="hljs-string">'README.md'</span>);
    <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;

    <span class="hljs-keyword">this</span>.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(file)</span> </span>{
      <span class="hljs-keyword">if</span> (!index &amp;&amp; file.filepath === <span class="hljs-string">'.'</span>) {
        <span class="hljs-keyword">if</span> (readme) {
          file.body = marked(readme.content || <span class="hljs-string">''</span>);
          file.title = readme.title || file.title;
        }
        <span class="hljs-keyword">else</span> {
          file.body = <span class="hljs-string">'Add a README.md'</span>;
        }

        file.writeHTML({
          destination: path.join(self.destination, <span class="hljs-string">'index'</span>)
        });
      }
      <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!index &amp;&amp; file.filepath === <span class="hljs-string">'README.md'</span>) {
         <span class="hljs-comment">/*do nothing*/</span>
      }
      <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(file.isFile) {
        file.writeHTML();
      }
    });

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.copyAssets();
  },

  copyAssets: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(options)</span> </span>{
    options = options || {};

    <span class="hljs-keyword">var</span> files = <span class="hljs-keyword">this</span>;
    <span class="hljs-keyword">var</span> cwd = options.cwd || <span class="hljs-keyword">this</span>.cwd;
    <span class="hljs-keyword">var</span> themePath = options.themePath || path.join(__dirname, <span class="hljs-string">'../resources/themes/default'</span>);
    <span class="hljs-keyword">var</span> assets = options.assets || <span class="hljs-keyword">this</span>.assets || <span class="hljs-string">'assets'</span>;
    <span class="hljs-keyword">var</span> assetsPath = options.assetsPath || path.join(themePath, assets);
    <span class="hljs-keyword">var</span> destination = options.destination || <span class="hljs-keyword">this</span>.destination;

    glob.sync(assetsPath +<span class="hljs-string">'/**/*'</span>, {
      cwd: cwd
    }).forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(assetpath)</span> </span>{
      <span class="hljs-keyword">var</span> assetRelative = path.join(assets, path.relative(assetsPath, assetpath));
      <span class="hljs-keyword">var</span> assetDest = path.join(destination, assetRelative);
      <span class="hljs-keyword">var</span> stats = fs.statSync(assetpath);

      <span class="hljs-keyword">if</span> (!stats.isDirectory()) {
        files.trigger(<span class="hljs-string">'copyasset'</span>, assetRelative);

        mkdirp.sync(path.dirname(assetDest));
        fs.writeFileSync(assetDest, fs.readFileSync(assetpath));
      }
    });
  }
});
</code></pre></div>
      </div>
      
    </div>
  </div>

  <footer>

  </footer>

  <script src="../assets/scripts/scripts.js"></script>
  <script>
  var config = {"files":["Gruntfile.js","README.md","lib/blocks-collection.js","lib/index.js","lib/rendering-utils.js","node_modules/ampersand-collection/ampersand-collection.js","node_modules/ampersand-model/ampersand-model.js","node_modules/files-collection/index.js","resources/themes/default/assets/scripts/scripts.src.js","resources/themes/default/assets/scripts/search.src.js","resources/themes/default/assets/styles/styles.css","resources/themes/default/file.jst","resources/themes/default/navigation-item.jst","resources/themes/default/navigation.jst","tasks/gtfd.js"],"active":"lib/index.js"};
  config.files = (config.files || []).map(function (filepath) {
    return { filepath: filepath };
  });
  config.el = document.body;
  new gtfd(config);
  </script>
</body>
</html>
