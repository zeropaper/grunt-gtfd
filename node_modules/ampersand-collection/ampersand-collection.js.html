
<html>
<head>
  <title>ampersand-collection.js</title>
  <link type="text/css" rel="stylesheet" href="../../assets/styles/styles.css" />
</head>
<body>
  <header>
    <div class="row">
      <h3><a href="../../index.html">Index</a></h3>
      <ul class="breadcrumb"><li>node_modules</li><li>ampersand-collection</li></ul>
    </div>
    <h1>ampersand-collection.js</h1>
  </header>

  <nav class="docs-nav">
<div class="search"></div>
<div class="toggle">Files</div>
<ul class="directory root">
<li class="">

<a href="../../Gruntfile.js.html">Gruntfile.js</a>

</li>

<li class="">

</li>

<li class="">


<span class="dirname">lib</span>

<ul class="directory">

<li class="">

<a href="../../lib/blocks-collection.js.html">blocks-collection.js</a>

</li>

<li class="">

<a href="../../lib/index.js.html">index.js</a>

</li>

<li class="">

<a href="../../lib/rendering-utils.js.html">rendering-utils.js</a>

</li>

</ul>

</li>

<li class="trail">


<span class="dirname">node_modules</span>

<ul class="directory">

<li class="trail">


<span class="dirname">ampersand-collection</span>

<ul class="directory">

<li class="active">

<a href="ampersand-collection.js.html">ampersand-collection.js</a>

</li>

</ul>

</li>

<li class="">


<span class="dirname">ampersand-model</span>

<ul class="directory">

<li class="">

<a href="../ampersand-model/ampersand-model.js.html">ampersand-model.js</a>

</li>

</ul>

</li>

<li class="">


<span class="dirname">files-collection</span>

<ul class="directory">

<li class="">

<a href="../files-collection/index.js.html">index.js</a>

</li>

</ul>

</li>

</ul>

</li>

<li class="">


<span class="dirname">resources</span>

<ul class="directory">

<li class="">


<span class="dirname">themes</span>

<ul class="directory">

<li class="">


<span class="dirname">default</span>

<ul class="directory">

<li class="">

<a href="../../resources/themes/default/file.jst.html">file.jst</a>

</li>

<li class="">

<a href="../../resources/themes/default/navigation-item.jst.html">navigation-item.jst</a>

</li>

<li class="">

<a href="../../resources/themes/default/navigation.jst.html">navigation.jst</a>

</li>

<li class="">


<span class="dirname">assets</span>

<ul class="directory">

<li class="">


<span class="dirname">scripts</span>

<ul class="directory">

<li class="">

<a href="../../resources/themes/default/assets/scripts/scripts.src.js.html">scripts.src.js</a>

</li>

<li class="">

<a href="../../resources/themes/default/assets/scripts/search.src.js.html">search.src.js</a>

</li>

</ul>

</li>

<li class="">


<span class="dirname">styles</span>

<ul class="directory">

<li class="">

<a href="../../resources/themes/default/assets/styles/styles.css.html">styles.css</a>

</li>

</ul>

</li>

</ul>

</li>

</ul>

</li>

</ul>

</li>

</ul>

</li>

<li class="">


<span class="dirname">tasks</span>

<ul class="directory">

<li class="">

<a href="../../tasks/gtfd.js.html">gtfd.js</a>

</li>

</ul>

</li>
</ul>
</nav>


  <div class="container content">
    <div>
      

      
      <div class="row">
        <div class="col-md-12 col-lg-6"></div>
        <div class="col-md-12 col-lg-6"><pre><code class="js"><span class="hljs-keyword">var</span> BackboneEvents = <span class="hljs-built_in">require</span>(<span class="hljs-string">'backbone-events-standalone'</span>);
<span class="hljs-keyword">var</span> classExtend = <span class="hljs-built_in">require</span>(<span class="hljs-string">'ampersand-class-extend'</span>);
<span class="hljs-keyword">var</span> isArray = <span class="hljs-built_in">require</span>(<span class="hljs-string">'is-array'</span>);
<span class="hljs-keyword">var</span> extend = <span class="hljs-built_in">require</span>(<span class="hljs-string">'extend-object'</span>);
<span class="hljs-keyword">var</span> slice = [].slice;


<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Collection</span><span class="hljs-params">(models, options)</span> </span>{
    options || (options = {});
    <span class="hljs-keyword">if</span> (options.model) <span class="hljs-keyword">this</span>.model = options.model;
    <span class="hljs-keyword">if</span> (options.comparator) <span class="hljs-keyword">this</span>.comparator = options.comparator;
    <span class="hljs-keyword">if</span> (options.parent) <span class="hljs-keyword">this</span>.parent = options.parent;
    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.mainIndex) {
        <span class="hljs-keyword">var</span> idAttribute = <span class="hljs-keyword">this</span>.model &amp;&amp; <span class="hljs-keyword">this</span>.model.prototype &amp;&amp; <span class="hljs-keyword">this</span>.model.prototype.idAttribute;
        <span class="hljs-keyword">this</span>.mainIndex = idAttribute || <span class="hljs-string">'id'</span>;
    }
    <span class="hljs-keyword">this</span>._reset();
    <span class="hljs-keyword">this</span>.initialize.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>);
    <span class="hljs-keyword">if</span> (models) <span class="hljs-keyword">this</span>.reset(models, extend({silent: <span class="hljs-literal">true</span>}, options));
}

extend(Collection.prototype, BackboneEvents, {
    initialize: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{},

    indexes: [],

    isModel: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(model)</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.model &amp;&amp; model <span class="hljs-keyword">instanceof</span> <span class="hljs-keyword">this</span>.model;
    },

    add: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(models, options)</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.set(models, extend({merge: <span class="hljs-literal">false</span>, add: <span class="hljs-literal">true</span>, remove: <span class="hljs-literal">false</span>}, options));
    },
</code></pre></div>
      </div>
      
      <div class="row">
        <div class="col-md-12 col-lg-6"><p> overridable parse method</p>
</div>
        <div class="col-md-12 col-lg-6"><pre><code class="js">    parse: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(res, options)</span> </span>{
        <span class="hljs-keyword">return</span> res;
    },
</code></pre></div>
      </div>
      
      <div class="row">
        <div class="col-md-12 col-lg-6"><p> overridable serialize method</p>
</div>
        <div class="col-md-12 col-lg-6"><pre><code class="js">    serialize: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.map(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(model)</span> </span>{
            <span class="hljs-keyword">if</span> (model.serialize) {
                <span class="hljs-keyword">return</span> model.serialize();
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">var</span> out = {};
                extend(out, model);
                <span class="hljs-keyword">delete</span> out.collection;
                <span class="hljs-keyword">return</span> out;
            }
        });
    },

    toJSON: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.serialize();
    },

    set: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(models, options)</span> </span>{
        options = extend({add: <span class="hljs-literal">true</span>, remove: <span class="hljs-literal">true</span>, merge: <span class="hljs-literal">true</span>}, options);
        <span class="hljs-keyword">if</span> (options.parse) models = <span class="hljs-keyword">this</span>.parse(models, options);
        <span class="hljs-keyword">var</span> singular = !isArray(models);
        models = singular ? (models ? [models] : []) : models.slice();
        <span class="hljs-keyword">var</span> id, model, attrs, existing, sort, i, length;
        <span class="hljs-keyword">var</span> at = options.at;
        <span class="hljs-keyword">var</span> sortable = <span class="hljs-keyword">this</span>.comparator &amp;&amp; (at == <span class="hljs-literal">null</span>) &amp;&amp; options.sort !== <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">var</span> sortAttr = (<span class="hljs-string">'string'</span> === <span class="hljs-keyword">typeof</span> <span class="hljs-keyword">this</span>.comparator) ? <span class="hljs-keyword">this</span>.comparator : <span class="hljs-literal">null</span>;
        <span class="hljs-keyword">var</span> toAdd = [], toRemove = [], modelMap = {};
        <span class="hljs-keyword">var</span> add = options.add, merge = options.merge, remove = options.remove;
        <span class="hljs-keyword">var</span> order = !sortable &amp;&amp; add &amp;&amp; remove ? [] : <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">var</span> targetProto = <span class="hljs-keyword">this</span>.model &amp;&amp; <span class="hljs-keyword">this</span>.model.prototype || <span class="hljs-built_in">Object</span>.prototype;
</code></pre></div>
      </div>
      
      <div class="row">
        <div class="col-md-12 col-lg-6"><p> Turn bare objects into model references, and prevent invalid models
 from being added.</p>
</div>
        <div class="col-md-12 col-lg-6"><pre><code class="js">        <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>, length = models.length; i &lt; length; i++) {
            attrs = models[i] || {};
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.isModel(attrs)) {
                id = model = attrs;
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (targetProto.generateId) {
                id = targetProto.generateId(attrs);
            } <span class="hljs-keyword">else</span> {
                id = attrs[targetProto.idAttribute || <span class="hljs-keyword">this</span>.mainIndex];
            }
</code></pre></div>
      </div>
      
      <div class="row">
        <div class="col-md-12 col-lg-6"><p> If a duplicate is found, prevent it from being added and
 optionally merge it into the existing model.</p>
</div>
        <div class="col-md-12 col-lg-6"><pre><code class="js">            <span class="hljs-keyword">if</span> (existing = <span class="hljs-keyword">this</span>.get(id)) {
                <span class="hljs-keyword">if</span> (remove) modelMap[existing.cid || existing[<span class="hljs-keyword">this</span>.mainIndex]] = <span class="hljs-literal">true</span>;
                <span class="hljs-keyword">if</span> (merge) {
                    attrs = attrs === model ? model.attributes : attrs;
                    <span class="hljs-keyword">if</span> (options.parse) attrs = existing.parse(attrs, options);</code></pre></div>
      </div>
      
      <div class="row">
        <div class="col-md-12 col-lg-6"><p> if this is model</p>
</div>
        <div class="col-md-12 col-lg-6"><pre><code class="js">                    <span class="hljs-keyword">if</span> (existing.set) {
                        existing.set(attrs, options);
                        <span class="hljs-keyword">if</span> (sortable &amp;&amp; !sort &amp;&amp; existing.hasChanged(sortAttr)) sort = <span class="hljs-literal">true</span>;
                    } <span class="hljs-keyword">else</span> {</code></pre></div>
      </div>
      
      <div class="row">
        <div class="col-md-12 col-lg-6"><p> if not just update the properties</p>
</div>
        <div class="col-md-12 col-lg-6"><pre><code class="js">                        extend(existing, attrs);
                    }
                }
                models[i] = existing;
</code></pre></div>
      </div>
      
      <div class="row">
        <div class="col-md-12 col-lg-6"><p> If this is a new, valid model, push it to the <code>toAdd</code> list.</p>
</div>
        <div class="col-md-12 col-lg-6"><pre><code class="js">            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (add) {
                model = models[i] = <span class="hljs-keyword">this</span>._prepareModel(attrs, options);
                <span class="hljs-keyword">if</span> (!model) <span class="hljs-keyword">continue</span>;
                toAdd.push(model);
                <span class="hljs-keyword">this</span>._addReference(model, options);
            }
</code></pre></div>
      </div>
      
      <div class="row">
        <div class="col-md-12 col-lg-6"><p> Do not add multiple models with the same <code>id</code>.</p>
</div>
        <div class="col-md-12 col-lg-6"><pre><code class="js">            model = existing || model;
            <span class="hljs-keyword">if</span> (!model) <span class="hljs-keyword">continue</span>;
            <span class="hljs-keyword">if</span> (order &amp;&amp; ((model.isNew &amp;&amp; model.isNew() || !model[<span class="hljs-keyword">this</span>.mainIndex]) || !modelMap[model.cid || model[<span class="hljs-keyword">this</span>.mainIndex]])) order.push(model);
            modelMap[model[<span class="hljs-keyword">this</span>.mainIndex]] = <span class="hljs-literal">true</span>;
        }
</code></pre></div>
      </div>
      
      <div class="row">
        <div class="col-md-12 col-lg-6"><p> Remove nonexistent models if appropriate.</p>
</div>
        <div class="col-md-12 col-lg-6"><pre><code class="js">        <span class="hljs-keyword">if</span> (remove) {
            <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>, length = <span class="hljs-keyword">this</span>.length; i &lt; length; i++) {
                model = <span class="hljs-keyword">this</span>.models[i];
                <span class="hljs-keyword">if</span> (!modelMap[model.cid || model[<span class="hljs-keyword">this</span>.mainIndex]]) toRemove.push(model);
            }
            <span class="hljs-keyword">if</span> (toRemove.length) <span class="hljs-keyword">this</span>.remove(toRemove, options);
        }
</code></pre></div>
      </div>
      
      <div class="row">
        <div class="col-md-12 col-lg-6"><p> See if sorting is needed, update <code>length</code> and splice in new models.</p>
</div>
        <div class="col-md-12 col-lg-6"><pre><code class="js">        <span class="hljs-keyword">if</span> (toAdd.length || (order &amp;&amp; order.length)) {
            <span class="hljs-keyword">if</span> (sortable) sort = <span class="hljs-literal">true</span>;
            <span class="hljs-keyword">if</span> (at != <span class="hljs-literal">null</span>) {
                <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>, length = toAdd.length; i &lt; length; i++) {
                    <span class="hljs-keyword">this</span>.models.splice(at + i, <span class="hljs-number">0</span>, toAdd[i]);
                }
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">var</span> orderedModels = order || toAdd;
                <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>, length = orderedModels.length; i &lt; length; i++) {
                    <span class="hljs-keyword">this</span>.models.push(orderedModels[i]);
                }
            }
        }
</code></pre></div>
      </div>
      
      <div class="row">
        <div class="col-md-12 col-lg-6"><p> Silently sort the collection if appropriate.</p>
</div>
        <div class="col-md-12 col-lg-6"><pre><code class="js">        <span class="hljs-keyword">if</span> (sort) <span class="hljs-keyword">this</span>.sort({silent: <span class="hljs-literal">true</span>});
</code></pre></div>
      </div>
      
      <div class="row">
        <div class="col-md-12 col-lg-6"><p> Unless silenced, it’s time to fire all appropriate add/sort events.</p>
</div>
        <div class="col-md-12 col-lg-6"><pre><code class="js">        <span class="hljs-keyword">if</span> (!options.silent) {
            <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>, length = toAdd.length; i &lt; length; i++) {
                model = toAdd[i];
                <span class="hljs-keyword">if</span> (model.trigger) {
                    model.trigger(<span class="hljs-string">'add'</span>, model, <span class="hljs-keyword">this</span>, options);
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">this</span>.trigger(<span class="hljs-string">'add'</span>, model, <span class="hljs-keyword">this</span>, options);
                }
            }
            <span class="hljs-keyword">if</span> (sort || (order &amp;&amp; order.length)) <span class="hljs-keyword">this</span>.trigger(<span class="hljs-string">'sort'</span>, <span class="hljs-keyword">this</span>, options);
        }
</code></pre></div>
      </div>
      
      <div class="row">
        <div class="col-md-12 col-lg-6"><p> Return the added (or merged) model (or models).</p>
</div>
        <div class="col-md-12 col-lg-6"><pre><code class="js">        <span class="hljs-keyword">return</span> singular ? models[<span class="hljs-number">0</span>] : models;
    },

    get: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(query, indexName)</span> </span>{
        <span class="hljs-keyword">if</span> (!query) <span class="hljs-keyword">return</span>;
        <span class="hljs-keyword">var</span> index = <span class="hljs-keyword">this</span>._indexes[indexName || <span class="hljs-keyword">this</span>.mainIndex];
        <span class="hljs-keyword">return</span> index[query] || index[query[<span class="hljs-keyword">this</span>.mainIndex]] || <span class="hljs-keyword">this</span>._indexes.cid[query] || <span class="hljs-keyword">this</span>._indexes.cid[query.cid];
    },
</code></pre></div>
      </div>
      
      <div class="row">
        <div class="col-md-12 col-lg-6"><p> Get the model at the given index.</p>
</div>
        <div class="col-md-12 col-lg-6"><pre><code class="js">    at: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(index)</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.models[index];
    },

    remove: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(models, options)</span> </span>{
        <span class="hljs-keyword">var</span> singular = !isArray(models);
        <span class="hljs-keyword">var</span> i, length, model, index;

        models = singular ? [models] : slice.call(models);
        options || (options = {});
        <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>, length = models.length; i &lt; length; i++) {
            model = models[i] = <span class="hljs-keyword">this</span>.get(models[i]);
            <span class="hljs-keyword">if</span> (!model) <span class="hljs-keyword">continue</span>;
            <span class="hljs-keyword">this</span>._deIndex(model);
            index = <span class="hljs-keyword">this</span>.models.indexOf(model);
            <span class="hljs-keyword">this</span>.models.splice(index, <span class="hljs-number">1</span>);
            <span class="hljs-keyword">if</span> (!options.silent) {
                options.index = index;
                <span class="hljs-keyword">if</span> (model.trigger) {
                    model.trigger(<span class="hljs-string">'remove'</span>, model, <span class="hljs-keyword">this</span>, options);
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">this</span>.trigger(<span class="hljs-string">'remove'</span>, model, <span class="hljs-keyword">this</span>, options);
                }
            }
            <span class="hljs-keyword">this</span>._removeReference(model, options);
        }
        <span class="hljs-keyword">return</span> singular ? models[<span class="hljs-number">0</span>] : models;
    },
</code></pre></div>
      </div>
      
      <div class="row">
        <div class="col-md-12 col-lg-6"><p> When you have more items than you want to add or remove individually,
 you can reset the entire set with a new list of models, without firing
 any granular <code>add</code> or <code>remove</code> events. Fires <code>reset</code> when finished.
 Useful for bulk operations and optimizations.</p>
</div>
        <div class="col-md-12 col-lg-6"><pre><code class="js">    reset: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(models, options)</span> </span>{
        options || (options = {});
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, length = <span class="hljs-keyword">this</span>.models.length; i &lt; length; i++) {
            <span class="hljs-keyword">this</span>._removeReference(<span class="hljs-keyword">this</span>.models[i], options);
        }
        options.previousModels = <span class="hljs-keyword">this</span>.models;
        <span class="hljs-keyword">this</span>._reset();
        models = <span class="hljs-keyword">this</span>.add(models, extend({silent: <span class="hljs-literal">true</span>}, options));
        <span class="hljs-keyword">if</span> (!options.silent) <span class="hljs-keyword">this</span>.trigger(<span class="hljs-string">'reset'</span>, <span class="hljs-keyword">this</span>, options);
        <span class="hljs-keyword">return</span> models;
    },

    sort: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(options)</span> </span>{
        <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;
        <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.comparator) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'Cannot sort a set without a comparator'</span>);
        options || (options = {});

        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-keyword">this</span>.comparator === <span class="hljs-string">'string'</span>) {
            <span class="hljs-keyword">this</span>.models.sort(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(left, right)</span> </span>{
                <span class="hljs-keyword">if</span> (left.get) {
                    left = left.get(self.comparator);
                    right = right.get(self.comparator);
                } <span class="hljs-keyword">else</span> {
                    left = left[self.comparator];
                    right = right[self.comparator];
                }
                <span class="hljs-keyword">if</span> (left &gt; right || left === <span class="hljs-keyword">void</span> <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
                <span class="hljs-keyword">if</span> (left &lt; right || right === <span class="hljs-keyword">void</span> <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;
                <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
            });
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.comparator.length === <span class="hljs-number">1</span>) {
            <span class="hljs-keyword">this</span>.models.sort(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(left, right)</span> </span>{
                left = self.comparator(left);
                right = self.comparator(right);
                <span class="hljs-keyword">if</span> (left &gt; right || left === <span class="hljs-keyword">void</span> <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
                <span class="hljs-keyword">if</span> (left &lt; right || right === <span class="hljs-keyword">void</span> <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;
                <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
            });
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">this</span>.models.sort(<span class="hljs-keyword">this</span>.comparator.bind(<span class="hljs-keyword">this</span>));
        }

        <span class="hljs-keyword">if</span> (!options.silent) <span class="hljs-keyword">this</span>.trigger(<span class="hljs-string">'sort'</span>, <span class="hljs-keyword">this</span>, options);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    },
</code></pre></div>
      </div>
      
      <div class="row">
        <div class="col-md-12 col-lg-6"><p> Private method to reset all internal state. Called when the collection
 is first initialized or reset.</p>
</div>
        <div class="col-md-12 col-lg-6"><pre><code class="js">    _reset: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">var</span> list = <span class="hljs-keyword">this</span>.indexes || [];
        <span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>;
        list.push(<span class="hljs-keyword">this</span>.mainIndex);
        list.push(<span class="hljs-string">'cid'</span>);
        <span class="hljs-keyword">var</span> l = list.length;
        <span class="hljs-keyword">this</span>.models = [];
        <span class="hljs-keyword">this</span>._indexes = {};
        <span class="hljs-keyword">for</span> (; i &lt; l; i++) {
            <span class="hljs-keyword">this</span>._indexes[list[i]] = {};
        }
    },

    _prepareModel: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(attrs, options)</span> </span>{</code></pre></div>
      </div>
      
      <div class="row">
        <div class="col-md-12 col-lg-6"><p> if we haven’t defined a constructor, skip this</p>
</div>
        <div class="col-md-12 col-lg-6"><pre><code class="js">        <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.model) <span class="hljs-keyword">return</span> attrs;

        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.isModel(attrs)) {
            <span class="hljs-keyword">if</span> (!attrs.collection) attrs.collection = <span class="hljs-keyword">this</span>;
            <span class="hljs-keyword">return</span> attrs;
        } <span class="hljs-keyword">else</span> {
            options = options ? extend({}, options) : {};
            options.collection = <span class="hljs-keyword">this</span>;
            <span class="hljs-keyword">var</span> model = <span class="hljs-keyword">new</span> <span class="hljs-keyword">this</span>.model(attrs, options);
            <span class="hljs-keyword">if</span> (!model.validationError) <span class="hljs-keyword">return</span> model;
            <span class="hljs-keyword">this</span>.trigger(<span class="hljs-string">'invalid'</span>, <span class="hljs-keyword">this</span>, model.validationError, options);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
    },

    _deIndex: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(model)</span> </span>{
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> name <span class="hljs-keyword">in</span> <span class="hljs-keyword">this</span>._indexes) {
            <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>._indexes[name][model[name] || (model.get &amp;&amp; model.get(name))];
        }
    },

    _index: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(model)</span> </span>{
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> name <span class="hljs-keyword">in</span> <span class="hljs-keyword">this</span>._indexes) {
            <span class="hljs-keyword">var</span> indexVal = model[name] || (model.get &amp;&amp; model.get(name));
            <span class="hljs-keyword">if</span> (indexVal) <span class="hljs-keyword">this</span>._indexes[name][indexVal] = model;
        }
    },
</code></pre></div>
      </div>
      
      <div class="row">
        <div class="col-md-12 col-lg-6"><p> Internal method to create a model’s ties to a collection.</p>
</div>
        <div class="col-md-12 col-lg-6"><pre><code class="js">    _addReference: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(model, options)</span> </span>{
        <span class="hljs-keyword">this</span>._index(model);
        <span class="hljs-keyword">if</span> (!model.collection) model.collection = <span class="hljs-keyword">this</span>;
        <span class="hljs-keyword">if</span> (model.on) model.on(<span class="hljs-string">'all'</span>, <span class="hljs-keyword">this</span>._onModelEvent, <span class="hljs-keyword">this</span>);
    },
</code></pre></div>
      </div>
      
      <div class="row">
        <div class="col-md-12 col-lg-6"><p> Internal method to sever a model’s ties to a collection.</p>
</div>
        <div class="col-md-12 col-lg-6"><pre><code class="js">    _removeReference: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(model, options)</span> </span>{
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span> === model.collection) <span class="hljs-keyword">delete</span> model.collection;
        <span class="hljs-keyword">this</span>._deIndex(model);
        <span class="hljs-keyword">if</span> (model.off) model.off(<span class="hljs-string">'all'</span>, <span class="hljs-keyword">this</span>._onModelEvent, <span class="hljs-keyword">this</span>);
    },

    _onModelEvent: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(event, model, collection, options)</span> </span>{
        <span class="hljs-keyword">if</span> ((event === <span class="hljs-string">'add'</span> || event === <span class="hljs-string">'remove'</span>) &amp;&amp; collection !== <span class="hljs-keyword">this</span>) <span class="hljs-keyword">return</span>;
        <span class="hljs-keyword">if</span> (event === <span class="hljs-string">'destroy'</span>) <span class="hljs-keyword">this</span>.remove(model, options);
        <span class="hljs-keyword">if</span> (model &amp;&amp; event === <span class="hljs-string">'change:'</span> + <span class="hljs-keyword">this</span>.mainIndex) {
            <span class="hljs-keyword">this</span>._deIndex(model);
            <span class="hljs-keyword">this</span>._index(model);
        }
        <span class="hljs-keyword">this</span>.trigger.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>);
    }
});

<span class="hljs-built_in">Object</span>.defineProperties(Collection.prototype, {
    length: {
        get: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.models.length;
        }
    },
    isCollection: {
        value: <span class="hljs-literal">true</span>
    }
});

<span class="hljs-keyword">var</span> arrayMethods = [
    <span class="hljs-string">'indexOf'</span>,
    <span class="hljs-string">'lastIndexOf'</span>,
    <span class="hljs-string">'every'</span>,
    <span class="hljs-string">'some'</span>,
    <span class="hljs-string">'forEach'</span>,
    <span class="hljs-string">'map'</span>,
    <span class="hljs-string">'filter'</span>,
    <span class="hljs-string">'reduce'</span>,
    <span class="hljs-string">'reduceRight'</span>
];

arrayMethods.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(method)</span> </span>{
    Collection.prototype[method] = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.models[method].apply(<span class="hljs-keyword">this</span>.models, <span class="hljs-built_in">arguments</span>);
    };
});
</code></pre></div>
      </div>
      
      <div class="row">
        <div class="col-md-12 col-lg-6"><p> alias each/forEach for maximum compatibility</p>
</div>
        <div class="col-md-12 col-lg-6"><pre><code class="js">Collection.prototype.each = Collection.prototype.forEach;

Collection.extend = classExtend;

<span class="hljs-built_in">module</span>.exports = Collection;
</code></pre></div>
      </div>
      
    </div>
  </div>

  <footer>

  </footer>

  <script src="../../assets/scripts/scripts.js"></script>
  <script>
  var config = {"files":["Gruntfile.js","README.md","lib/blocks-collection.js","lib/index.js","lib/rendering-utils.js","node_modules/ampersand-collection/ampersand-collection.js","node_modules/ampersand-model/ampersand-model.js","node_modules/files-collection/index.js","resources/themes/default/assets/scripts/scripts.src.js","resources/themes/default/assets/scripts/search.src.js","resources/themes/default/assets/styles/styles.css","resources/themes/default/file.jst","resources/themes/default/navigation-item.jst","resources/themes/default/navigation.jst","tasks/gtfd.js"],"active":"node_modules/ampersand-collection/ampersand-collection.js"};
  config.files = (config.files || []).map(function (filepath) {
    return { filepath: filepath };
  });
  config.el = document.body;
  new gtfd(config);
  </script>
</body>
</html>
