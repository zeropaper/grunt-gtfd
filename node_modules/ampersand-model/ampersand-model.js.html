
<html>
<head>
  <title>ampersand-model.js</title>
  <link type="text/css" rel="stylesheet" href="../../assets/styles/styles.css" />
</head>
<body>
  <header>
    <div class="row">
      <h3><a href="../../index.html">Index</a></h3>
      <ul class="breadcrumb"><li>node_modules</li><li>ampersand-model</li></ul>
    </div>
    <h1>ampersand-model.js</h1>
  </header>

  <nav class="docs-nav">
<div class="search"></div>
<div class="toggle">Files</div>
<ul class="directory root">
<li class="">

<a href="../../Gruntfile.js.html">Gruntfile.js</a>

</li>

<li class="">

</li>

<li class="">


<span class="dirname">lib</span>

<ul class="directory">

<li class="">

<a href="../../lib/blocks-collection.js.html">blocks-collection.js</a>

</li>

<li class="">

<a href="../../lib/index.js.html">index.js</a>

</li>

<li class="">

<a href="../../lib/rendering-utils.js.html">rendering-utils.js</a>

</li>

</ul>

</li>

<li class="trail">


<span class="dirname">node_modules</span>

<ul class="directory">

<li class="">


<span class="dirname">ampersand-collection</span>

<ul class="directory">

<li class="">

<a href="../ampersand-collection/ampersand-collection.js.html">ampersand-collection.js</a>

</li>

</ul>

</li>

<li class="trail">


<span class="dirname">ampersand-model</span>

<ul class="directory">

<li class="active">

<a href="ampersand-model.js.html">ampersand-model.js</a>

</li>

</ul>

</li>

<li class="">


<span class="dirname">files-collection</span>

<ul class="directory">

<li class="">

<a href="../files-collection/index.js.html">index.js</a>

</li>

</ul>

</li>

</ul>

</li>

<li class="">


<span class="dirname">resources</span>

<ul class="directory">

<li class="">


<span class="dirname">themes</span>

<ul class="directory">

<li class="">


<span class="dirname">default</span>

<ul class="directory">

<li class="">

<a href="../../resources/themes/default/file.jst.html">file.jst</a>

</li>

<li class="">

<a href="../../resources/themes/default/navigation-item.jst.html">navigation-item.jst</a>

</li>

<li class="">

<a href="../../resources/themes/default/navigation.jst.html">navigation.jst</a>

</li>

<li class="">


<span class="dirname">assets</span>

<ul class="directory">

<li class="">


<span class="dirname">scripts</span>

<ul class="directory">

<li class="">

<a href="../../resources/themes/default/assets/scripts/scripts.src.js.html">scripts.src.js</a>

</li>

<li class="">

<a href="../../resources/themes/default/assets/scripts/search.src.js.html">search.src.js</a>

</li>

</ul>

</li>

<li class="">


<span class="dirname">styles</span>

<ul class="directory">

<li class="">

<a href="../../resources/themes/default/assets/styles/styles.css.html">styles.css</a>

</li>

</ul>

</li>

</ul>

</li>

</ul>

</li>

</ul>

</li>

</ul>

</li>

<li class="">


<span class="dirname">tasks</span>

<ul class="directory">

<li class="">

<a href="../../tasks/gtfd.js.html">gtfd.js</a>

</li>

</ul>

</li>
</ul>
</nav>


  <div class="container content">
    <div>
      

      
      <div class="row">
        <div class="col-md-12 col-lg-6"></div>
        <div class="col-md-12 col-lg-6"><pre><code class="js"><span class="hljs-comment">/*$AMPERSAND_VERSION*/</span>
<span class="hljs-keyword">var</span> State = <span class="hljs-built_in">require</span>(<span class="hljs-string">'ampersand-state'</span>);
<span class="hljs-keyword">var</span> _ = <span class="hljs-built_in">require</span>(<span class="hljs-string">'underscore'</span>);
<span class="hljs-keyword">var</span> sync = <span class="hljs-built_in">require</span>(<span class="hljs-string">'ampersand-sync'</span>);


<span class="hljs-keyword">var</span> Model = State.extend({
    save: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(key, val, options)</span> </span>{
        <span class="hljs-keyword">var</span> attrs, method, sync, attributes = <span class="hljs-keyword">this</span>.attributes;
</code></pre></div>
      </div>
      
      <div class="row">
        <div class="col-md-12 col-lg-6"><p> Handle both <code>&quot;key&quot;, value</code> and <code>{key: value}</code> -style arguments.</p>
</div>
        <div class="col-md-12 col-lg-6"><pre><code class="js">        <span class="hljs-keyword">if</span> (key == <span class="hljs-literal">null</span> || <span class="hljs-keyword">typeof</span> key === <span class="hljs-string">'object'</span>) {
            attrs = key;
            options = val;
        } <span class="hljs-keyword">else</span> {
            (attrs = {})[key] = val;
        }

        options = _.extend({validate: <span class="hljs-literal">true</span>}, options);
</code></pre></div>
      </div>
      
      <div class="row">
        <div class="col-md-12 col-lg-6"><p> If we’re not waiting and attributes exist, save acts as
 <code>set(attr).save(null, opts)</code> with validation. Otherwise, check if
 the model will be valid when the attributes, if any, are set.</p>
</div>
        <div class="col-md-12 col-lg-6"><pre><code class="js">        <span class="hljs-keyword">if</span> (attrs &amp;&amp; !options.wait) {
            <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.set(attrs, options)) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>._validate(attrs, options)) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
</code></pre></div>
      </div>
      
      <div class="row">
        <div class="col-md-12 col-lg-6"><p> After a successful server-side save, the client is (optionally)
 updated with the server-side state.</p>
</div>
        <div class="col-md-12 col-lg-6"><pre><code class="js">        <span class="hljs-keyword">if</span> (options.parse === <span class="hljs-keyword">void</span> <span class="hljs-number">0</span>) options.parse = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">var</span> model = <span class="hljs-keyword">this</span>;
        <span class="hljs-keyword">var</span> success = options.success;
        options.success = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(resp)</span> </span>{
            <span class="hljs-keyword">var</span> serverAttrs = model.parse(resp, options);
            <span class="hljs-keyword">if</span> (options.wait) serverAttrs = _.extend(attrs || {}, serverAttrs);
            <span class="hljs-keyword">if</span> (_.isObject(serverAttrs) &amp;&amp; !model.set(serverAttrs, options)) {
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            }
            <span class="hljs-keyword">if</span> (success) success(model, resp, options);
            model.trigger(<span class="hljs-string">'sync'</span>, model, resp, options);
        };
        wrapError(<span class="hljs-keyword">this</span>, options);

        method = <span class="hljs-keyword">this</span>.isNew() ? <span class="hljs-string">'create'</span> : (options.patch ? <span class="hljs-string">'patch'</span> : <span class="hljs-string">'update'</span>);
        <span class="hljs-keyword">if</span> (method === <span class="hljs-string">'patch'</span>) options.attrs = attrs;</code></pre></div>
      </div>
      
      <div class="row">
        <div class="col-md-12 col-lg-6"><p> if we’re waiting we haven’t actually set our attributes yet so
 we need to do make sure we send right data</p>
</div>
        <div class="col-md-12 col-lg-6"><pre><code class="js">        <span class="hljs-keyword">if</span> (options.wait) options.attrs = _.extend(model.serialize(), attrs);
        sync = <span class="hljs-keyword">this</span>.sync(method, <span class="hljs-keyword">this</span>, options);

        <span class="hljs-keyword">return</span> sync;
    },
</code></pre></div>
      </div>
      
      <div class="row">
        <div class="col-md-12 col-lg-6"><p> Fetch the model from the server. If the server’s representation of the
 model differs from its current attributes, they will be overridden,
 triggering a <code>&quot;change&quot;</code> event.</p>
</div>
        <div class="col-md-12 col-lg-6"><pre><code class="js">    fetch: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(options)</span> </span>{
        options = options ? _.clone(options) : {};
        <span class="hljs-keyword">if</span> (options.parse === <span class="hljs-keyword">void</span> <span class="hljs-number">0</span>) options.parse = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">var</span> model = <span class="hljs-keyword">this</span>;
        <span class="hljs-keyword">var</span> success = options.success;
        options.success = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(resp)</span> </span>{
            <span class="hljs-keyword">if</span> (!model.set(model.parse(resp, options), options)) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            <span class="hljs-keyword">if</span> (success) success(model, resp, options);
            model.trigger(<span class="hljs-string">'sync'</span>, model, resp, options);
        };
        wrapError(<span class="hljs-keyword">this</span>, options);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.sync(<span class="hljs-string">'read'</span>, <span class="hljs-keyword">this</span>, options);
    },
</code></pre></div>
      </div>
      
      <div class="row">
        <div class="col-md-12 col-lg-6"><p> Destroy this model on the server if it was already persisted.
 Optimistically removes the model from its collection, if it has one.
 If <code>wait: true</code> is passed, waits for the server to respond before removal.</p>
</div>
        <div class="col-md-12 col-lg-6"><pre><code class="js">    destroy: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(options)</span> </span>{
        options = options ? _.clone(options) : {};
        <span class="hljs-keyword">var</span> model = <span class="hljs-keyword">this</span>;
        <span class="hljs-keyword">var</span> success = options.success;

        <span class="hljs-keyword">var</span> destroy = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
            model.trigger(<span class="hljs-string">'destroy'</span>, model, model.collection, options);
        };

        options.success = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(resp)</span> </span>{
            <span class="hljs-keyword">if</span> (options.wait || model.isNew()) destroy();
            <span class="hljs-keyword">if</span> (success) success(model, resp, options);
            <span class="hljs-keyword">if</span> (!model.isNew()) model.trigger(<span class="hljs-string">'sync'</span>, model, resp, options);
        };

        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.isNew()) {
            options.success();
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
        wrapError(<span class="hljs-keyword">this</span>, options);

        <span class="hljs-keyword">var</span> sync = <span class="hljs-keyword">this</span>.sync(<span class="hljs-string">'delete'</span>, <span class="hljs-keyword">this</span>, options);
        <span class="hljs-keyword">if</span> (!options.wait) destroy();
        <span class="hljs-keyword">return</span> sync;
    },
</code></pre></div>
      </div>
      
      <div class="row">
        <div class="col-md-12 col-lg-6"><p> Proxy <code>ampersand-sync</code> by default — but override this if you need
 custom syncing semantics for <em>this</em> particular model.</p>
</div>
        <div class="col-md-12 col-lg-6"><pre><code class="js">    sync: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> sync.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>);
    },
</code></pre></div>
      </div>
      
      <div class="row">
        <div class="col-md-12 col-lg-6"><p> Default URL for the model’s representation on the server — if you’re
 using Backbone’s restful methods, override this to change the endpoint
 that will be called.</p>
</div>
        <div class="col-md-12 col-lg-6"><pre><code class="js">    url: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">var</span> base = _.result(<span class="hljs-keyword">this</span>, <span class="hljs-string">'urlRoot'</span>) || _.result(<span class="hljs-keyword">this</span>.collection, <span class="hljs-string">'url'</span>) || urlError();
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.isNew()) <span class="hljs-keyword">return</span> base;
        <span class="hljs-keyword">return</span> base + (base.charAt(base.length - <span class="hljs-number">1</span>) === <span class="hljs-string">'/'</span> ? <span class="hljs-string">''</span> : <span class="hljs-string">'/'</span>) + <span class="hljs-built_in">encodeURIComponent</span>(<span class="hljs-keyword">this</span>.getId());
    }
});
</code></pre></div>
      </div>
      
      <div class="row">
        <div class="col-md-12 col-lg-6"><p> Throw an error when a URL is needed, and none is supplied.</p>
</div>
        <div class="col-md-12 col-lg-6"><pre><code class="js"><span class="hljs-keyword">var</span> urlError = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'A "url" property or function must be specified'</span>);
};
</code></pre></div>
      </div>
      
      <div class="row">
        <div class="col-md-12 col-lg-6"><p> Wrap an optional error callback with a fallback error event.</p>
</div>
        <div class="col-md-12 col-lg-6"><pre><code class="js"><span class="hljs-keyword">var</span> wrapError = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(model, options)</span> </span>{
    <span class="hljs-keyword">var</span> error = options.error;
    options.error = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(resp)</span> </span>{
        <span class="hljs-keyword">if</span> (error) error(model, resp, options);
        model.trigger(<span class="hljs-string">'error'</span>, model, resp, options);
    };
};

<span class="hljs-built_in">module</span>.exports = Model;
</code></pre></div>
      </div>
      
    </div>
  </div>

  <footer>

  </footer>

  <script src="../../assets/scripts/scripts.js"></script>
  <script>
  var config = {"files":["Gruntfile.js","README.md","lib/blocks-collection.js","lib/index.js","lib/rendering-utils.js","node_modules/ampersand-collection/ampersand-collection.js","node_modules/ampersand-model/ampersand-model.js","node_modules/files-collection/index.js","resources/themes/default/assets/scripts/scripts.src.js","resources/themes/default/assets/scripts/search.src.js","resources/themes/default/assets/styles/styles.css","resources/themes/default/file.jst","resources/themes/default/navigation-item.jst","resources/themes/default/navigation.jst","tasks/gtfd.js"],"active":"node_modules/ampersand-model/ampersand-model.js"};
  config.files = (config.files || []).map(function (filepath) {
    return { filepath: filepath };
  });
  config.el = document.body;
  new gtfd(config);
  </script>
</body>
</html>
